arXiv:2510.25351v1 [physics.flu-dyn] 29 Oct 2025

Model-Adaptive Simulation of Hierarchical Shallow Water
Moment Equations in One Dimension

Rik Verbiest*! and Julian Koellermeier! ?

Bernoulli Institute, University of Groningen
?Department of Mathematics, Computer Science and Statistics, Ghent University

October 30, 2025

Abstract

Shallow free surface flows are often characterized by both subdomains that require
high modeling complexity and subdomains that can be sufficiently accurately modele
with low modeling complexity. Moreover, these subdomains may change in time as
the water flows through the domain. This motivates the need for space and time
adaptivity in the simulation of shallow free surface flows. In this paper, we develop
the first adaptive simulations using the recently developed Shallow Water Moment
Equations, which are an extension of the standard Shallow Water Equations tha
allow for vertically changing velocity profiles by including additional variables an
equations. The model-specific modeling complexity of a shallow water moment model
is determined by its order. The higher the order of the model, the more variables an
equations are included in the model. Shallow water moment models are ideally suite
for adaptivity because they are hierarchical such that low-order models and high-order
models share the same structure. To enable adaptive simulations, we propose two
approaches for the coupling of the varying-order shallow water moment equations
at their boundary interfaces. The first approach dynamically updates padded state
variables but cannot be written in conservative form, while the second approach
uses fixed padded state variable values of zero and reduces to conservative form for
conservative moment equations. The switching procedure between high-order models
and low-order models is based on a new set of model error estimators, originating
from a decomposition of the high-order models. Numerical results of the collision of a
dam-break wave with a smooth wave yield accurate results, while achieving speedups
up to 60 percent compared to a non-adaptive model with fixed modeling complexity.

1 Introduction

The Shallow Water Equations (SWE) are a set of non-linear partial differential equations
that describe fluid flows for which the horizontal length scale is much larger than the
vertical length scale. In the SWE, the horizontal velocity field is assumed to be constant
over the vertical position variable via depth-averaging. This severe simplification renders
the SWE inaccurate in applications such as dam breaks, where the vertical variability
cannot be neglected [22]. For this reason, the Shallow Water Moment Equations (SWME)
were derived in [20]. These hierarchical equations are more flexible than the SWE, because

“Corresponding author, email address r.verbiest@rug.nl
Model-adaptive SWME

R. Verbiest

they allow vertical variability in the horizontal velocity components by introducing M € N
additional variables, so-called moments, that describe the vertical velocity profile of the
horizontal velocity components at the additional complexity of adding also M additional

evolution equations for those moments.
1D shallow free surface flows [I7| [20], open curved shallow channel flow [27],
symmetric free surface flow [229] and bedload transport problems [II], for examp

On the one hand, a higher order My € N means that more variables and more ec
are included in the moc
of simulations with non-uniform flow [17] [20] 29], i.e., flow in which the horizontal
profile varies considera
hand, includes less variables and equations and is therefore computationally less ex:
oss in non-uniform flow simulations. Thus, choosing the orc
ated to a trade-off between accuracy and computational ef
More precisely, one wants to simulate a shallow fluid flow using the SWME wi
s as possible while achieving acceptable accuracy. In si

at

the SWME model is re

momen

The SWME have successfully — ap’

plied to
radially
le.

The level of complexity included in the SWME model is determined by its order M.

el, increasing the modeling complexity
oly over the vertical variable. A lower

the cost of accuracy

uations
and increasing the accuracy
velocity
order My € N, on the other
pensive,
er M of
ficiency.
h as few

imulations where the flow is

complex, for example when the flow velocity is non-uniform, one can expect to need a high

orc

near-uniform flow, i.e., a
the ver

ler to achieve acceptable accuracy for the user. On the ot.

flow in which the horizontal velocity

her hand, a simulation of a
only has small variations in

ical variable, can be described sufficiently accurately by a low-order SWME model,

including the SWE [10]. Note that the SWME of order zero coincide with the SWE.

This is

ind

break waves have not reached yet [9] [21]. This calls for ac

Dif

1.

Mesh Refinement (AMR

In many applications,
the case in dam breaks, for example, as the flow is

k, but the flow is smooth in tha

uced by the dam breal

fferent methods exist to incorporate adaptivity. One

1e fi

where there are strong gradients of the numerical solution).

ap’
we.

plied in numerical schemes for the simulation of the SWE,

l-balanced version of AMR, is used for the simulation of

the complexity of the flow varies throughout the flow domain.

discontinuous at the wave

part of the flow that the dam
apti

ivity in the flow simulation.

common approach is Adaptive
[4], a well-known numerical approach that adds adaptivity to
the simulation by locally refining the spatial mesh where t

ow is complex (for example,
AMR has been successfully
for example in [7], where a
soth smooth test cases and

a dam break test case. To ensure conservation, a flux correction procedure needs to be

im)

local
mo
can
coupling of the different models and the
the models, which may or may not be

The SWME, however,
models share the same structure, such that the

the types of numerical method used.
approach, because different-orc
same numerical scheme can be used in
hierarchical, as lower-order SWME are included
which simplifies the coupling of

D.

is a pure
the spatial
porate ada:

y numerical algori
mesh.

ptivity in the simu
0 locally change the

Another approach to incor
ly modify the numerical method but t
el adaptivity. The advantage of moc
(0 the local

ye directly incorporated int model.

emented. Since the AMR approach refines or coarsens the spatial mesh locally and
does not change the model, i
numerical methods by refining

hm that switches between

ation of the fluid is not to
model instead. We call this

el adaptivity is that the local flow complexity
The key component is then a necessary

different numerical!

ifficult, depending

er SWME

he entire domain.

adaptive hierarchical SWME
Our proposed adaptive simulation strategy of the SWME

methods used to simulate
on the types of model and
are ideally suited for this

Moreover, the SWME are

as a special case in higher-order SWME,

models considerably.
is the following: in regions

of high complexity, a high-order SWME model with order My is used to capture the
Model-adaptive SWME R. Verbiest

complexity with sufficient accuracy, while in regions of low complexity, a low-order SWME
model with order My, with small computational effort is used with sufficient accuracy. The
switching procedure between high-order SWME and low-order SWME should be based
on a suitable set of error estimators that estimate the model error made using a SWME
model of a certain order. In this paper, a set of error estimators based on a decomposition
of the SWME is proposed.

Adaptive simulation of moment models has recently gained increased interest for the
simulation of rarefied gases in kinetic theory using moment models. This inspires the
development of adaptive simulation methods for the SWME as the kinetic moment models
and the SWME have a similar form. In [24], a heuristic procedure is used to vary the order
of a kinetic moment model. Other authors base their domain decomposition on a direct
estimation of the model error [I]. In [14], error estimators based on (gradients of) the
numerical solution are numerically studied. A final approach that is worth mentioning is
the micro-macro decomposition [18], which decomposes the time integration of hierarchical
kinetic moment equations into potentially several small micro steps with a higher-order
model and a single large macro step with a lower-order model. Another approach is a
data-driven reduction of the number of variables in the model. In [15], model reduction
of a hyperbolic regularization of the SWME using POD-Galerkin and dynamical low-
rank approximation is studied and shown to result in accurate numerical simulations and
considerable runtime improvements. Previous works have studied the coupling of the fully
resolved Reynolds-Averaged Navier-Stokes equations with the SWE and with SWME
models of fixed order M [26]. So far, no adaptive method coupling two different-order
SWME models exists.

In this paper, the first model-adaptive procedure for the simulation of a free surface
flow modeled by the SWME model is introduced. This will accomplish the goal to derive a
generalizable numerical scheme for the accurate but fast adaptive simulation of the SWME.
A path-conservative finite volume scheme is used to numerically solve the SWME model
in non-conservative form. The adaptive procedure consists of the following two steps: (1)
The first step decomposes the domain into subdomains, each modeled by SWME models
with a time- and space-dependent order by locally evaluating a set of error estimators,
constructed based on a decomposition of the SWME model; (2) The second step is the
coupling of the different-order SWME models at their boundary interfaces in a stable
way and (ideally) such that conserved quantities are conserved. The advantage of this
approach is that each subdomain is modeled with sufficient physical complexity and that

the same finite volume solver can be used in the entire domain.

The remainder of the paper is organized as follows. In Section 2} the SWME model is
briefly reviewed. The error estimators and the coupling of the subdomains are discussed
in Section In Section numerical simulations are performed to test the adaptive
procedure. The paper ends with a brief conclusion.

2 Shallow Water Moment Equations

The SWME were derived in as an extension of the classical SWE. In the two-
dimensional case (one horizontal dimension « € 9, C R and one vertical dimension
z €Q, C R), the derivation starts from the conservation of mass and momentum given
by the incompressible Navier-Stokes equations in the physical space (x,z) € Qe x Q:,
describing the evolution of the velocity (u, w) € R?, where u is the horizontal velocity and
where w is the vertical velocity. Under the assumptions that the flow is shallow, i.e., the
Model-adaptive SWME R. Verbiest

horizontal scale is much larger than the vertical scale, that the pressure hydrostatic, that
the fluid is Newtonian with kinematic viscosity v € R*, and that the bottom topography
hy € R is constant, the incompressible Navier-Stokes equations can be reduced to

0,u + 0,w = 0, (2.1
‘ 1
Ou + Ay (u?) + 0:(uw) = —Oyp + vd2,u, (2.2
Pp
with hydrostatic pressure p(t, 2,2) = (hs(t,x) — z)pg, where p and g are the density anc

the gravitational constant, respectively, and where h,(t,x) is the surface topography. In
(20), the vertical variable z is transformed to
mo hp

C= Hee)" ¢ € (0, 1], 2.3

where h(t, 7) = hs(t,x) — hp is the water height. Equations (2.1)

are transformed to

Oh + Ox(htm) = 0, 2.4
‘ a Pe g z Vv,
O;(htt) + Ox (ni? 21?) + O¢ (hiiw “Xit) 0. 2.5

The variables of interest are the water height h(t,x) : [0,T]xQz2 + Rt and the transformec
horizontal velocity w(t, 7, ¢) : [0,T]xQz.x [0,1] 4 R. The mean velocity um(t, x) : [0,T]xQ2 > R
is defined by um(t, 2) := to u(t,z,¢)d¢. Finally, w[h, a] is the vertical coupling operator,

defined by

alti, Hl = By (1 | [ "tani 2) — u(t. ¢))aC). 2.6)

In the remainder of this paper, the tilde in &@ is dropped for readability. The main idea
in the derivation of the SWME is to expand the horizontal velocity u(t,2,¢) in a
truncated Legendre sum of order M:

M

i=1

where aj(t,x) : [0,7] x Qz + R are the basis coefficients, also called moments, and the
basis functions ¢;(¢) : [0,1] 4 R are the scaled and shifted Legendre polynomials of degree
i, withi =1,...,M, where M €N is the order of the SWME model that determines how
many basis coefficients and basis functions are included in the expansion. Equations for
the moments a;(t,x) are obtained by projecting the momentum equation onto the
Legendre polynomials ¢;(¢), i-e., multiplication of with ¢i(¢), i = 1,...,M, and

subsequent integration with respect to ¢. This is a generalization of depth-averaging,
which is equivalent to projecting (2.5) onto the constant test function ¢9(¢) = 1. We refer

Model-adaptive SWME R. Verbiest

the interested reader for details to 20]. The resulting Mth order SWME model reads

Oh + Oy (hum) = 0, (2.8)
YY~
:=Fo
O:(hUm) + Ox ( H(t + 5 He + + on =-5 beds) + Sa) (2.9)
SEES ae

M )- M

O(hai) + Oz | h| 2umoay + > Ajjrajar = UmOz (hai) — Bijn0K%Ox (ha)

jk=1 jk=l
=Fi41 =Qi41
7 (2.10)
r
(+1)5 tn + YO cus) ay , i=l,...,M,
j=l
= Sit1

where the constant coefficients A;j,, Bij, and Ci; correspond to integrals related to the
Legendre polynomials and are defined in [20], and where \ € R® is the slip length,
originating from the slip boundary condition at the bottom. Collecting the conservative
fluxes in the vector Fur (wu) ‘= (Fo, Fi,..-, Fi) € RM“, the non-conservative fluxes

in the vector Om (1) := (0,0, Qo,...,Qi41) € R™+?, the source terms in the vector
Su(wu) := (0,51, $2,...,Si41) € R™+? and constructing the non-conservative flux
matrix Q ae ye RM +2)x(M +2) from the non-conservative fluxes (a) u(t), Equations
can be written in compact form as
HG + Au (ti)Ociue = Su (tin), (2.11
with state variable vector
wu = Oult,x) = (h(t, x), h(t, ©)um(t, x), h(t, x)ar(t,a),...,h(t,c)am(t,x))? € RM,
(2.12
transport system matrix
OF (wu , j
Am (tm) = oF (tu) ~ Qu (ti) € RY) (2.13
Ow
and source term ‘ue (tm) € RM“ +2. The non-conservative flux matrix Qs (t,,) is definec

oy the relation Qar(War) = Qu (wWau)Orwm.

This non-conservative system of partial differential equations is only hyperbolic
for M = 0 and M = 1 220). This motivated the authors of [17] to regularize the system
matrix such that it has real eigenvalues, obtaining the so-called Hyperbolic Shallow Water
Moment Equations (HSWME), which are hyperbolic for arbitrary order M. Recently, the
HSWME have been extended to axisymmetric flow [29] and 2D flow [3]. Other variations
of the SWME include the Shallow Water Linearized Moment Equations [16], SWME for
edload problems [II], dispersive SWME [25], and SWME with the Chézy friction model
(27]. In this paper, the standard SWME as derived in are used for the analysis of
he adaptive procedure and the numerical simulations. However, the adaptive procedure
in this paper can be applied to each of the SWME models mentioned in this section with
only minor adjustments.

ot
Model-adaptive SWME R. Verbiest

Notation. In the remainder of this paper, we will denote a SWME model of a certain
order M by the short notation SWME,y.
2.1 Examples

In this section, we will briefly state three specific examples of the SWME: the SWMEo
(M = 0), the SWME, (M = 1) and the SWME2 (M = 2), first derived in [20]. These
examples will be used throughout the paper to illustrate the error estimation and domain
decomposition in Section [3-1] The numerical simulations in Section |4| however, will be
run with larger orders WM.

SWMEp. For M =0, the SWME (2.8)-(2.10) reduce to the SWE and read

a h 0 1 a h y{ 0 (2.14)
i a . :
‘ hum gh- u2, 2um * hum \ \ um

The velocity is constant in the vertical variable: u(t,2,¢) = Um(t, 2).

SWME,. The SWME, are given by (2.8)-(2.10) with M = 1 and read

h 0 1 0 h 0
2 v
On} hum | + | gh—u2, — 2 2um 2a Oz | htm | = “x Um + a4
ha, —2umar 201 Um hay 3(tm ta,+ 44.0)
(2.15)
The velocity is linear in the vertical variable: u(t, 2,¢) = Um(t, x) + a1(t,x)61(C).
SWME,. The SWME) are given by (2.8)-(2.10) with M = 2 and read
h 0 1 0 0 h
2 2 6
hum 4 gh- ua, _ a — 2 2Um Fay 2a . hum
hay —2umay — faia2 201 Um+ag2 3a, hay
hag —Fat — 2aqUm — 203 209 $y Um + 3a» hag @ 16)
0
Vv Um + ay

3(um +azy+ag+ 44a1)
5 (um +ay+ag+ 124.02)

The velocity is quadratic in the vertical variable: u(t, 2, ¢) = Um(t, ©) +a1(t, x)b1(¢)+aa(t, 2) ¢2(C)-

3 Adaptive Simulation of Shallow Water Moment Equations

In this section, an algorithm for the model-adaptive simulation of the SWME will be
constructed. The algorithm consists of two steps: (1) the first step, discussed in Section
Model-adaptive SWME R. Verbiest

is a domain decomposition, dividing the domain into subdomains, each modeled by a
SWME model of an appropriate order M, where the appropriate order is determined by a
set of error estimators that estimate the error made by restricting the velocity expansion
to the first IM moments and Legendre polynomials. (2) The second step, discussed in
Section, (3.2) is the spatial coupling of the subdomains at the boundary interfaces of the
subdomains, i.e., the interfaces that separate two subdomains modeled by SWME models
with different orders.

Spatially- and time-adaptive order. So far, the order M of the SWME model has
been treated as fixed and constant in time and space throughout the literature. As
argued in the introduction, in many applications, some subdomains require more modeling
complexity than other subdomains. This motivates the need for a spatially-adaptive order.
Moreover, the number of subdomains and the boundaries of the subdomains change in time
as the waves travel through the fluid domain. This motivates the need for a time-adaptive
order. Instead of assuming a constant order M/, we will therefore consider a space- and
time-dependent order M = M(t, x) in this paper.

3.1 Domain decomposition

In this paper, we propose error estimators based on a decomposition of a higher-order
SWMEw,,, with My ¢ N. The idea is to use the hierarchical structure of the SWME,
such that the effect of adding higher-order moments can be directly estimated. This
allows for an efficient model error approximation. Using the hierarchical structure of the
equations (2-11), a lower-order SWMEy,, with My, ¢ N and where My < My, can be
identified within the decomposition of the higher-order SWMEy,,,, such that the deviation
of the higher-order SWMEm,, from the lower-order SWME,y,, can be evaluated. The
error estimators are then used to decompose the domain into subdomains, each modeled
by a SWME model of an appropriate order. This is done by evaluating whether the
error estimators exceed chosen thresholds, which results in a set of domain decomposition
criteria for model-coarsening, i.e., reducing the order of the SWME model from My to
Mz, and for model-refinement, i.e., increasing the order of the SWME model from My, to
My. The analytical form of the domain decomposition criteria for model-coarsening and
model-refinement are given in Definition B.T]and Definition B-2} respectively. For numerical
simulations, the analytical domain decomposition criteria are numerically evaluated on the
grid. This is discussed in Sec ‘ion [4.1] in which the numerical evaluation of the analytical
domain decomposition criteria is summarized in expressions (£1), and (£3).

Remark 3.1. Many existing variants of shallow water moment models have a hierarchical
structure as well, not only the SWME derived in [20], such that the same ideas can be
applied accordingly.

Let us first introduce the following notation. The higher-order state variable vector
Buy € RMH+ (2.12) is decomposed as

7 .My
WMy = \ _ ’ (3.1)
UMy:My

where ty, € R“+*? contains the first My+2 variables of Wy, and where tyy,-1n, € RME-ML
contains the remaining variables.

Model-adaptive SWME R. Verbiest

Remark 3.2. Note that the notation w.z, does not denote the first My, entries of the vector
UWMy, as might suggest at first sight, but the first Mp +2 entries, as the water height h
and the mean velocity wu, are always included in the lower-order model. The subscript
:M, in W..4,, was used instead of the subscript .17,42 to keep the notation as compact as
possible.

The system matrix Ajy,(tda,) € ROMH+?)* (Mu+2) of the higher-order SWME Mu
is accordingly decomposed as

Amu (Wy) = (

A:M,.:M, (My) A:M,,.My:My (My) )
:

Amy:Ma:M, (Wy) AM,:My,My:My (Way)

where:

© AM, (OMy) € ROML+)*(ML+2) are the entries in the first My, +2 rows and the

first My, + 2 columns of Ajsy (Wary),

© Ain My:My (Wy) € R(M41.+2)x(Mu-Mt) are the entries in the first My, + 2 rows and
the last My — Mz, columns of Ayy, (ty)

© AM MyM, (Wmy) € R(Mu—-Mi)x(Mi+2) are the entries in the first Mp +2 columns
and the last My — My, rows of Any, (Wu),

© AM.:My,My:My (Way) € R(Mu-Mi)x(Mu-Mt) are the entries in the last My — My
rows and the last My — My, columns of Ajy, (t4,)-

Finally, the source term Sg My (My) € Rut? of the SW. MEwm,, is decomposed as

~ oo, Siu, (
Say (My) = ( hg ns ) (3.3)

SM :My (OMy)

where S.yj, (tag,) € R““*+? contains the first My +2 entries of Syr,(War,) and where
Si:My (Woy) € R™u-M. contains the remaining entries. Inserting the decompositions

and (3.3) in the general form (2.11), the SWMEyry, can be written as

g OM, 4. Aimy: Mi (GMy) A: .Mu:Mu (My) a UM, Sun, (ary)
et) . “ - cy =—leée =~ ;
WMy:My Amu:Mu:M,(OMy) AMp:My.Mu:My (my) WM, :My Sy My (OMy)

(3.4)
while the SWMEw, (2.11) reads
Op, + Am, (Wy, )OrU My, = Su, (Conve ) ‘ (3. 5)

with system matrix Ay, (Wu) € RM%42)*42) and source term San, (Gas, € RM+?,

From the hierarchical structure of the SWME (2-8)- (2-10) (lower-order SWME models
are included as a special case in higher-order SWME models), it follows that A:iy, :, (Way)
and Sg. M, (Wy) can be written as

Aimy :M (Wty) = Am, (8.x, af 6AM, ,My (Way Js (3.6)

Sinn, (Wnty) = San, (B.my,) + 6S, ay ay), (3.7)
Model-adaptive SWME R. Verbiest

where JAng, My(O_y) € ROM+?)x(+2) represents the difference between the system

matrices of the SWMEy, and the SWMEw,, for the first My + 2 variables and where

6S My,My(Wa,) € RM“+? represents the difference between the source terms of the SWMEyy,
and the SWME,,, for the first My+2 variables. The analytical formulas for 6A, My (Wy)

and 58, ‘Mi,My (my) are given in Appendix Comparing the SWMEyy,, (3.4) with the

SWMEy,, (3.5), one can see that if the equation

( JAM, Mu (Omy (t*, 2*)) )e ( Wn, (t*, 2")

WM, :My (t*, 2*)

. = 55M, M, (wy, (,2")) (3.8)
A.M, ,My:My (my (t*, *)) ) oe

holds for some ¢* € [0,7] and some 2* € Q;,, then the SWMEy,, (3.4) is equivalent to the
SWMEy, (3.5) for the first My + 2 variables, at (t*,«*). Note that if the higher-order
variables Wy, (B,a*) = de R™u—-ML | then it follows from the hierarchical structure of

and the derivation in Appendix [A] that

Sinn, (GAP, (t*,2°)) = Sun, (Wan, (t*,2*)), (3.9
Aca cat, (OQ, (t, 0°) = Av, (Wm, (*,2*)), (3.10

T ‘
where we defined BO Ci (w: om, (t*, a*yT, 0") Ee R™n+2. Thus, if we assume that
ja;(t*,a*)| <1 for i = My +1,..., My, then dAyy, my, (Wm, (t*, 2*)) can be neglected anc

Equation (3.8) reduces to

Any, My:Mu (Om (t", 2") Ona saty (t", 2") = 0. (3.11

We further require that O;t8y4, a1, (t*, 2*) = 0 € RMu-ML_, which holds if the equation

( AMy:My:-My (UMy(t*, 2*)) je ( O.m, (t*, v*)

, — = Siimty (Gay (t*,2*)) (3-12)
Oy :My (t*, 2*)

AM, :My,Mu:Mu (WMy (t*, 2*))
is satisfied at (t*,2*). Equation (3.12) ensures that the assumption |a;(t*,«*)| < 1,
i = My +1,...,Mu, and Equation (8.11) remain valid around t*. Equations (3.11) and
(3.12) are fulfilled if the higher-order SWMEj;,, model does not add significant modeling
terms and the lower-order SWMEyj,,, model is sufficient.

Model-coarsening criteria. Assume that the flow is modeled by the higher-order
SWMEm, model. To identify where the order of the SWME model can be reduced
from higher order My to lower order My, without losing much modeling complexity, the

validity of Equations (3.11) and (3.12) is verified using their respective numerical residuals.
Define the residuals of Equations (3.11) and (3-12) at (¢*,2*) by Riu, (t*,2*) € RMLY
and Riy.My(t*,2*) € RMA, respectively:

Rim, (tO, 0") = Aimy. My:My(WMy (t", 2*)) Ory my (t*, &*), (3.13)

. re 4
AM:Mu,:Mi (My (t*, 2*)) ) ( Way, (t*, 2*)

OMy:My(t*, 2")

Ry :My(t", 2") = ( ) — Sims (tim, (t*, 2*)).-

(3.14)

AM.:Muy,Mi:My (Oy (i, x*))
Model-adaptive SWME R. Verbiest

The norm of the residual R.,4, (t*,2*) determines how large the deviations corresponding
to the gradients of the higher-order variables Wyr,:iy,(t*,2*) are, while the norm of the
residual Ry: (t*, x*) quantifies the change of the higher-order variables Wyy,:a1y (t*, 2*)
in time. The two residuals R.jy, (t*,2*) (3.13) and Rag:ay(t*, 2*) can be inter-
preted as error estimators. Then, these error estimators are used to construct model-
coarsening criteria that identify regions where the order can be reduced.

Definition 3.1 (Model-coarsening criteria). Let (t*,x*) € [0,T]xQ, and let My, My € N,
with My, < My. Define the residuals R.uy,(t*,x*) and Ru:my(t*,2*) by (3.13) and
(3.14), respectively. The set of model-coarsening criteria at (t*,«*) is given by

[Gaga (t*, @*)| oo S Ews Rim ("2") Ilo < Rim? [Rag imu (C*, @*)I|o < Ruy my
(3.15)
If all three model-coarsening criteria in ( ) are satisfied, then the order is reduced from
higher order My to lower order My, where éw, Rev,

(Ruy my © Rt are chosen tolerances.

The choice of the max norm || = |loo im ||Wag,:,(t*,2*)||,, < €w is motivated by the
fact that the magnitude of each of the higher-order variables in wWyy,:;r4(t*, x*) needs to

be small for Equations (3.9) and (3.10) to hold approximately.

Model-refinement criteria. Assume now that the flow is modeled by the lower-order
SWMEyy, model. To identify where the order of the SWME model should be increased
from lower order My, to higher order My to capture the complex fluid flow dynamics,
the following rationale will be used. Note that the systems and cannot be
compared in this case, as the SWMEnj,,, model does not include the higher-order variables
WM,:My- To circumvent this problem, we assume that the SWMEy, and the SWMEyy,
are equivalent at (t*,2*) in the specific case where

WMy:My (t*, “*) = 0 € RMa-ML and Or OM My (et; i) = 0 € RMa-M (3.16)

Note that the higher-order variables way, ::4,(t*,2*) are not even defined at (¢*,2*), but
that we assume that the SWMEy,, is actually originating from the SWMEy,, with the
higher-order variables equal to zero. Under this assumption, Equation (3.12) reduces to

Anya an, (Op (t*, 2”) )Oyti-my, (t",@") = Sanaa (OO? (t*, x*)). (3.17)

One can easily verify that under the assumptions and (3.17), the SWMEyy, is indeed
equivalent to the SWMEy,,. For the equivalence between the lower order SWMEyy,
and the higher order SWMEy,,, to hold in time around ¢ = t*, Equation needs
to be satisfied. Analogously to the identification of regions where the order can be

reduced from higher-order My to lower-order Mz using equations (3.11) and (3.12),

one could calculate the magnitude of the residual of Equation (3.17). However, the

(0) cannot be

quantity Am :Ma:M, (Oy (Os x*))0,.,(t*,x*) appearing in Equation (
calculated since the flow at (t*,2*) is modeled by the lower-order SWMEyz,. Calculating
the residual of Equation would therefore require solving additional equations. To
avoid additional calculations, we will therefore verify whether a particular solution to
that is easy to calculate is satisfied. One particular solution to at (t*,2*)
that is easy to verify is given by the relations and the additional relations

Satuimta (Op, 2") = Oe RMa-M and OW: (t*, 0*) = Oe R™. (3.18)

10
Model-adaptive SWME R. Verbiest

The left-hand sides of the expressions in (3.18) can be interpreted as error estimators for
refining the model. Then, these error estimators are used to construct model-refinement
criteria that identify regions where the order should be increased.

Definition 3.2 (Model-refinement criteria). Let (t*,2*) € [0,T]xQ, and let My, My € N,
with My, < My. The set of model-refinement criteria is given by

The order is increased if one of the model-refinement criteria in (3.19) is satisfied, where
kg € Rt and ka € R® are chosen tolerances.

Suiysaa(@Qy (t,2*))|| > ms, Orta (t,2")lloo > Ko. (3.19)

Remark 3.3. The domain decomposition criteria proposed in definitions[3-T]and[B.2] can be
viewed as an extension of classical AMR mesh-refinement criteria related to the gradient of
the height and the gradient of the momentum, which are included in the second criterion

in Definition 3.2] for the shallow water equations [2\[I3]. The crucial difference of
the adaptive procedure proposed in this paper with respect to AMR is that, in this paper,
the model is coarsened or refined, and not the mesh.

Remark 3.4. For moment models in kinetic theory, it is shown that the magnitude of the
last moment(s) can be used to detect non-equilibrium regions, which require more modeling
complexity [14], and near-equilibrium regions, where the model can be coarsened, similarly

to the first criterion in (3.15) in Definition B.1]

3.1.1 Example: SWME, and SWME 2

wD

In this subsection, the sets of domain decomposition criteria for model-coarsening (3.15}
and model-refining at (t*,a*) € [0,7] x Q2 proposed in the previous subsection
will be explicitly written for the case where the lower order is My, = 1 and the higher
order is My = 2. The SWME, and the SWME» are given by Equations (2.15) and (2.16),
respectively. In this case, the matrix 6Aj,9(wo(t*,«*)) and the vector 6S1,2(we(t*, x*)
constructed in Appendix [A] are given by

0 0 0 0
5Aj2(t(t*,a*)) = | —taz 0 0 and 59),9(io(t*,2*)) = —3 a2 |, (3.20
—tara2 0 ag 302

respectively. Note that the dependence on (t*,x*) is not explicitly written for readability.
Clearly, 5.A1,2(w2(t*,x*)) and 65119 (to(t*, x*)) vanish for vanishing moment az, as seen in
(3.10) and (3-9), respectively, and in Appendix [A] for arbitrary orders My and My,. As
mentioned before, this is a result of the hierarchical structure of the SWME (2.11). In

addition, §1.2(@ (t*,2*)) is given by

Si2(wy (t*,2*)) = 55 (um + 04): (3.21)

The domain decomposition criteria proposed in the previous subsection can now be written
explicitly.

11
Model-adaptive SWME R. Verbiest

Model-coarsening criteria from My = 2 to My, = 1. The norm of the residual
Ra(t*,x*) (3.13) is given by

T
Hopi 2 3
|Ra(t*,2*)|\. = | (0 50202 (ha2), 5210s(he) (3.22)
2
and the norm of the residual R1.2(t*, x*) (3.14) reads
ep 2 2 2 9 1
||Ria(t*,2*)||, = 341 — 2a2Um — 702 Ozh + 20207 (htm) + 3u102(har)
; , (3.23)
+ (um + #02) Oz (haz) + By (um +ai+a2+ 12409)
2
The model-coarsening criteria are thus given by
— 2 3 r
|hag(t*,x*)| <e, 0, 50202 (haz), 50102 (haz) <€Riy; (3.24)
)
2» 25 1
3a 2a2Um 702 Orh + 20202 (hUm) + 3102 (hon)
(3.25)
E Xr
+ (um Se #02) 0, (hag) 4 5 (um + ay + a2 4 125 0a) <ER 2+
D
2

If all conditions in (3.24)-(8.25) are satisfied, then equations (3.11) and (3.12) are approx-

imately fulfilled and the order is reduced at (t*,x*) from higher order My = 2 to lower
order My, = 1.

Model-refinement criteria from My, =1to My =2. The model-refinement criteria
(3.19) are now written explicitly for the case My, = 1 and My = 2:

y

[55 (um + a)| > Kg, |O,h(t*,2*)| > Ka, |Or(htm(t*,2*))| > Ka, |O2(hai(t*, 2*))| > Ka.
(3.26)

(3.26) is satisfied, then the validity of Equation (3.12) is not

guaranteed and the order is increased from lower order My = 1 to higher order My = 2.

If one of the conditions in

3.2 Boundary interface coupling

The second main challenge of the model-adaptive simulation of SWME models is the
spatial coupling at the boundary interfaces, where two subdomains modeled by a different
order SWME model border each other. In the context of finite volume schemes, the spatial
coupling problem of two SWME models of a different order is the computation of the flux
between two cells that have a different number of variables. In this paper, we propose two
approaches that are extensions of the method proposed in [80] to compute this boundary
interface flux. The two approaches will be illustrated by considering one boundary interface
and one canonical domain decomposition example. The resulting formulas can then be
applied at each boundary interface for a general domain decomposition.

12
Model-adaptive SWME R. Verbiest

Spatial discretization notation. Equation (2.11) is discretized on Q, with grid size
Az, yielding the semi-discretized cell-averaged moment vectors

w; = (hi(t), (htm)i(t), (hoy);(t),..., (hag):(t))” € RM? (3.27

in the grid cells C; = [x;-Aa/2,2;+Ax/2| with equidistant cell centers x;, i = 1,2,..., Nz,
and discretized in time with time step At, yielding the fully discretized cell-averagec
moment vectors

w? = (bP, (hum)? (har)?,...,(hay)?)? € RV? (3.28

at discrete times tn, n = 0,1,...,N;. Note that the vector notation is dropped for
simplicity and to distinguish the discretized moment vectors from the unknown functions
described by Equation (2-11). In particular, the subscript 7 in w; denotes the cell-averagec
value in the cell labeled i and should not be confused with the subscript M in wy in
Equation that denotes the order of the moment model.

Global finite volume discretization. The overarching finite volume solver for the
numerical simulation of Equation (2-1), is a first-order time-splitting scheme introduced
in [12]. Equation is split into a transport part and a source term part, yielding the
two subproblems

Oy + Au(wu)20m = 0, (3.29)

For the numerical simulation of the transport step (3-29), we consider a finite volume
scheme and choose the Polynomial Viscosity Method (PVM) [6] notation, as common for
applications of the SWME, because it is generally applicable to non-conservative systems
and it includes well-known schemes such as the PRICE scheme [5], which will be used for
the numerical simulations in Section [| For the simulation of the transport step of
the SWME,, (2-11), with a global order M, the PVM reads

At
wrt up 2 (DEy +53), i=1,...,No, (3.31)

: att - + _ gty, n ain ¥
with fluctuations Diya = Ag (uj, wi.,) given by

AX(ui, W;) = S(Ao(u, Wr) + (wr — w) £ Qo(wi, wy) + (wr — w1)), (3.32)

with generalized Roe linearization Ae = Ao(wi, wr) given by

1
Ao (wy, wr) + (wr — wi) = / Aar( (3310, 1)) (5 Ww), Wr) ds, (3.33)
0 F

and where the numerical viscosity matrix
Qo(wi, wr) = P(Ao(w, wr)) (3.34)

is a function P(-) of the generalized Roe linearization. Here, 6(s;w),w;) : RO RY+?
denotes a path connecting the left state w; € R@+? and the right state w, € R/*+? at the

13
Model-adaptive SWME R. Verbiest

cell interface, such that ®(0; w,w,) = w and ®(1;w),w;,) = w;. For future use, we state
the linear path ®jy(s; w1, wr) = (1—s)-wi+s-wr. For the numerical simulations presented
in Section [4] the transport step (3.29) is numerically solved using the PRICE scheme [5],
which can be written as a PVM scheme (3.31) with polynomial viscosity matrix

Ax At 5

I+ — Aj (wi, wy). (3.35)

Qa(u,w) = ang! + AG

The source term step (3.30) is discretized using implicit Euler because of its unconditional
stability [12]. Because of the specific form of the source term in the SWME (2.11), the
implicit Euler method for (3.30) can be written as

1
wrt (2 - in) w", (3.36)

hn

where the matrix S ¢ R(+?)x(“+2) is defined in [[2] and can be computed offline to
allow for an efficient integration of subproblem (3.30). For the details, we refer to [12].

Canonical domain decomposition example. One particular domain decomposition
situation is considered as a canonical example to describe the spatial coupling approaches
discussed in the remainder of this section. The situation is illustrated in Figure[]] Assume
that a domain decomposition as outlined in Section is performed at time t, after
obtaining the numerical solutions w7’, for i = 1,..., Nz, resulting in the updated model
orders M?*! and M7*? in the subdomains Qu, D Cy, and Qu, D Cr, respectively, where
Le {1,...,N,—1} and R = L+1 are cell indices. Note that in Section [3.1] the subscript
°L’ in My, was used to denote the order of the lower-order model, while in this section the
subscript ’L’ in the notation Mrt is used to denote the order of the model used in the
left subdomain Qy,,. The boundary interface is located at « = x, + Ax/2, between the
cells Cr, and Cr, so cell Cz, is the cell left of the boundary interface x = x, + Ax/2 and cell
Cr is the cell right of the boundary interface 7 = 1, + Ax/2. Moreover, assume, without
loss of generality, that mnt < Mp.

Remark 3.5. In the remainder of this section, we will drop the superscripts n and n+1 that
indicate the discrete time for readability. However, note that the domain decomposition
is time-dependent and that both the orders M; and Mp, and the boundary interface
positions vary in time.

As illustrated in Figure[]] cells Cz and Cr are neighboring cells, bordering the boundary
interface at = x, + Av /2, that contain the left lower-order state variables

wr = (hp, (htm), (har)z,---; (ham, )t)” € RM (3.37)
and the right higher-order state variables
wr = (hr, (hum)p, (hai)R,.--; (ham,)R)” € RMat? (3.38)

respectively. At the boundary interface, the PVM scheme (3.31) needs to be adjusted to
account for the fact that the left state w, ¢ RM«+? and the right state we €¢ R“*#+? are
modeled by different transport matrices and contain a different number of variables.

Two extensions of the classical PVM equations (3.31) are proposed in the following
two subsections: (1) The first approach uses an adaptation of the so-called Padded Buffer

14
Model-adaptive SWME R. Verbiest

Qu, xp + Ax/2 OMp eR

—_______@ —__—*"__;
—— eye

SWMEy, SWMEy,

Figure 1: Canonical domain decomposition example: the left lower-order subdomain Qy,, is
modeled by the lower-order SWMEy,, and the right higher-order subdomain Qy,, is modeled by
the higher-order SWMEyz,,, with Mz < Mr. Modified from [30], Fig. 1.

Cell (PBC) coupling, introduced for linear moment models of rarefied gases in [30].
In the PBC coupling method, the lower-order state variable vector wz is padded with
additional moments, the so-called padded moments, such that it has the same length as
the higher-order state variable vector wr. The padded moments are treated as additional
variables. This approach allows for a smooth transition between the two different-order
SWME models but can in general not be written in conservative form for conservative
moment systems; (2) The second approach, called Conservative Interface Flux (CIF), is
introduced in this paper. In the CIF coupling method, the padded moments are set to zero,
such that they can effectively be removed from the numerical scheme. The CIF coupling
method can be written in conservative form for conservative moment systems for the first
Mr +2 equations, but it results in a sharper transition between the two different-order
SWME models, making the method less robust and more susceptible to small oscillations
introduced by the coupling.

3.2.1 Boundary interface flux: Padded Buffer Cell (PBC)

In the PBC boundary interface coupling method [30] applied to the non-linear and non-
conservative SWME (2.11), the lower-order SWMEy,, and the higher-order SWME)y,, are
coupled by padding the left lower-order state variable vector w, € RM“+? with additional
moments ((@a4, +1) L,+++> (Gatg)L) € RMr-™L, yielding the so-called padded vector

Wr = (hp, (hum)z, (har)r,--., (hom, )r, (hay, 41)25---,(h@atg)t)” € RMR*?, (3.39)

making it compatible with wp € R”#+?. This is illustrated in Figure [2] The coupling is
then defined by the generalized Roe linearization (3.33) at the boundary interface between
the cells Cz and Cr, given by

ae

7s (s; Wr, wr)ds, (3.40)

1
Ao(WL, wr): (wR - wr) = | A(®(s; Wz, wrR))

0
where the matrix A(-) € R(et+?)x(Mr+2) and the path O(-) € RMF+? are yet to be
defined. The PBC coupling uses the linear path ®(s;@z,wr) = Pin(s;Wr,wrR) and the
higher-order system matrix A(®(s; Wz, wr)) = Amp (Plin(s; Wz, wR)) along this path. The
rightward fluctuation Dy 2 € RMa+2 (3.32) needs to implement a boundary condition
for the padded moments ((@y, +1)15---; (Gap)t)’: while the fluctuation Dy -sj2 € RM:+2
(3.32) uses wy instead of the padded moment vector Wy, i.e.,

Ae
2 2

_ _ At (wr-1, WL)
D = AzZ(wr-1, vz), DY i= 2 heron Fe 3.41
L-3 a ols t) L- Pe wp-1, Wz) : ( )

15
Model-adaptive SWME

R. Verbiest

Separating
interface
erp + Ag/2
Domain
decomposition
Cells C R C. R+1
Cell-averaged
. Ww Ww :
hp hr hry
(htm) 2-1 (hum) R (htm) R41
Cell-averaged (hay) p-1 L v2 (hai)r (hai)R+1
moments - : i jl : q :
(ham,)L-1 (hom, )z | (hom, )t (ham, )r (ham, )R+1
hemp +1)L (hom, +1)R (hom, +1)R+1
(hOMp)L (hamy)R (hor) R+1
a |
Padded buffer cell
Figure 2: Padded Buffer Cell with added moments Qj, 41,-..,Q@., in cell Cy, yielding the

padded vector wz. The flux between cells C; and Cr is computed using the padded vector wy
instead of wy. Modified from [30], Fig. 2.

where Apouna(wr—1, Wz) € R™r-Mt yepresents an interface boundary condition for the
padded moments, which originates from the artificial boundary for the padded moments.
We propose the boundary condition Apouna(wr-1, WL) = Amp—M, (WL-1, WL): (Wp_-1—Wr),
where we defined @,_, € R“8*? as

Wp1:= (hr-1, (htm) p15 (hoi) p_43+++5 (hOm,) p15 (h@my 41) p++ (heim) ,)
(3.42)
and where ay,—m, € RO42-M1)*(Mn+2) are the last Mp — Mz rows of AZ (@p-1, 01)
(3.33), computed using a linear path and using the system matrix of the SWME,,,. This
specific boundary condition is chosen to avoid the introduction of waves at the boundary
interface caused by the higher-order moments that are only defined in the right subdomain
Qm,. The PBC coupling is summarized in the following definition:

Definition 3.3 (Padded Buffer Cell (PBC) coupling). Consider the canonical domain
decomposition example illustrated in Figure Define the padded vector Wr by (3.39).

The Padded Buffer Cell (PBC) interface coupling for the computation of the updates for
Wr and wr is given by the generalized Roe linearization

: 08;
Ao(Wr, wr): (wr - Wr) = / Amp (Piin(s; Wr, wR) ae (8 Wr, wR)ds (3.43)
0 F
inserted in the fluctuations DF 1 (8.32), together with the fluctuations Dey defined in
2 2
(3.41). The generalized Roe linearizations at the remaining interfaces are simply given by
a OP pin
Ae(wi, wisi): (wi — Wi) = Am, (Piin(s5 wi, wi41)) (55 wr, wiy)ds, (3.44)
0 F
1 IP jin
Aas weet) rsa — We) =f Anta Biin(ssee41)) Es; ars ast)ds, (845)
0 F

16
Model-adaptive SWME R. Verbiest

forl=1,...,L—2 andr=R,...,N,—-—1.

The PBC boundary interface coupling defined in Definition B.3]is a non-linear version of
the existing PBC coupling introduced in [30] for linear moment equations of rarefied gases.
The PBC boundary interface coupling can in general not be written in conservative
form for a conservative system of moment equations, but it allows for a smooth transition
between the two different order moment models.

Remark 3.6. For an efficient implementation of the PBC, we will require each subdomain
in the domain decomposition to consist of at least four cells, such that the vectors wz_1
and wy can be efficiently stored. Note that this smooths the domain decomposition.

3.2.2 Boundary interface flux: Conservative Interface Flux (CIF)

A general property of PVM schemes (3.31) is that the schemes can be written in conser-
vative form when applied to a conservative moment system, and thus it is desired that
our adaptive finite volume scheme mimics this property. However, the PBC coupling
proposed in the previous section based on [30] does not satisfy this property. Note that
the SWMEw contain non-conservative terms for all M > 0, such that a treatment
for these non-conservative terms is necessary.

Remark 3.7. While we use the standard non-conservative SWME throughout this
work, the general procedure proposed in this paper is also applicable to other hierarchical
moment models. We are therefore using a general notation below. An example of a
conservative system of moment equations is the Hermite Spectral Method (HSM)|8], which
is a linear system of PDEs describing the evolution of a rarefied gas. The HSM equations
are simulated with a fixed domain decomposition and with the linear form of the PBC

(3.43) in [30]. The SWE (2.14) can also be written in conservative form,

coupling (
but are included here in their non-conservative form.

To obtain an adaptive finite volume scheme that reduces to a conservative finite volume
scheme for conservative moment equations, consider as means of example the general form
of a conservative system of moment equations

Ov + Op fr (ur) =O, (3.46

describing the evolution of the conserved quantities Wy, € R@*+?, for which the generalized
Roe linearization (3.33) is computed as

Ao(w’, wr) + (w? — wf) = fur(w?) = fur(wr), (3.47

regardless of the path ®(s; w), w,), so that the PVM scheme can be written as

At
wrt! =u? — (Fla - Fa), (3.48
+ bf a z

with numerical flux function based on a PVM method

nm lie n re n nom
Fue 5 (fu wt ) + fru (w71) — P(Ao(w; wis). (3.49

Note that we added the superscript n indicating the time discretization, but that this
superscript will be dropped again for readability. We want to define the generalized Roe
linearization at the boundary interface between the cells C, and Cr such that the resulting

17
Model-adaptive SWME R. Verbiest

finite volume scheme can be written in the conservative form (3.48) for a conservative
system of moment equations. We will therefore set the padded moments to zero:

(Gaz 41)r5---+(@mp)n)’ =F RVR Me, (3.50)

The domain decomposition notation introduced in Section. Tis applied here with My, = Mz,
and My = Mr. Then, we define a piecewise path ®pw(s; WL, wR, $0) resembling the Tuomi

path [19] [28]:

S =WR:M, + (1 - )wr
Piow($; WL; WR) = (* “ “0 » § S80,

(0,...,0)7

®pw(s; Br, wR, $0) = (3.51)

~ WR,:M,
Pnigh(s; OL, wR) = _ ; 8 > 80,
1a, UR,Mz:Mp

where wri, € R™t+ and WR,Mzp:Mp © R™Mr—-M1 are defined as the first Mz, + 2 entries
of wr and the last Mp — My, entries of wp, respectively:

wr:M, *= (he, (htm), (hai)R,---, (han, )R) € RML+2 (3.52)
WR,M,:Mp (= ((ham,+1)R; 5 5 (ham,)R)” € RMaML (3.53)

The parameter so € [0,1] determines where the segment ®jow(s;-) ends and where the
segment Ppign(s;-) starts. The piecewise path ®),(s;-) is visualized in Figure The
choice of the piecewise path ®,,,(s;-) is motivated by the fact that the padded zeros are
not computed variables. Therefore, it is intuitive to split the path in a segment that only
considers the first Mz; + 2 variables and a segment that only considers the last Mp — Mz,
variables while keeping the first Mz; + 2 variables fixed. Note that the path is

UM,:Mp

Figure 3: Piecewise path ®,,,,(s; -) (3.51) is composed of the two segments ®jow(s;-) and ®yign(s;-).
The linear path ®),(s;-) is shown for comparison.

continuous but not differentiable in s = so, see Figure B| The derivative of the piecewise

18
Model-adaptive SWME R. Verbiest

path ®,,(s,-) with respect to s (everywhere apart from s = sg) reads

_ Liy =
Brow (sin wR) _ (sia "), 8 < 89,

Os

= Anign(sitiewe) _ ( (0,---,0)" S$ > 89.
os a M,:Mp

The integral in the generalized Roe linearization is effectively split into an integra‘
along the segment ®),y,(s;-) and an integral along = segment Ppign(s; ‘):

so ti
Ao(Wr, wr): (wR —- Wr) = | Alow (Plow (8; WL, may 108 (s; zr, wr)ds
0

(3.55

al
+f Ansan @rign( ss Br, we) SEH (s Wi, wR)ds,
a6 s

where the matrices Alow (+) € RMr+2)x(Mr+2) and Anign(-) € R(Met2)x(Mrt2) need to
be defined. We choose Ajow(-) = Anign(-) = Ay,(-) and then evaluate this matrix along
the path. Along the segment ®j,w(s;-), the last Mp — Mz; moments are equal to zero.
As observed in Section [3-1] from the hierarchical structure of the SWME (2-8)-(2-To) it
follows that

~ s s
A.m,,:Mz (Plow (s; Oz, wrR)) = Am, ( gg RM ( *) wr) : (3.56)
Using (8.56) and inserting the derivative of the path as given by (3.54), the respective

integral in (3.55) along ®jow(s;@z, wR) can be calculated as

1 ia Au, (& WReM, + +(1 - a) we) A (3.57)
0

5 -(WR:M, — WL).
0 AMz:Mp,:M1 (Sura, + (1 - <)wr)

The integral along the segment ®nign(s; -) can be written as

1 Ll Arty MisMn (Prign( si tie, wr)) Jas ss (3.58)

1-50 AM, :My.Mz:Mp(Pnigh(s; Wr, wR)

Inserting equations @B. 57) and B. 58) into B. BB) 5 yields the CIF boundary interface coupling
method. Note that, to fix the padded moments ((Q@ar, +1)1,---,(@mp) zt) = = 0, the last
Mr— Mz entries of Dis are set to zero.

z

Definition 3.4 (Conservative Interface Flux (CIF) coupling). Consider the canonical
domain decomposition example illustrated in Figure [i Define the padded vector wr by

(3.39) and (3.50), where the padded moments ((Qu, 41)L, +--+ (Gaty)t)” = 0 are equal to
zero. The Conservative Interface Flua (CIF) interface coupling for the computation of the
updates for Wr and wr is given by the generalized Roe linearization

Vf Ain -Mp(Phien($; WL, w
Agl@s, un)-lon—Te) = 1 / ( -My,My:Mp( high ( ie, ° a “Rei

1— 89 AMz:Mp,Mz:Mp(Pnign(S; WL, WR
8

-(WR:M, — WL),

. i r Am, (Sura, + (1 = <) wz) ts
$0 }J0 \ Any:Mp.: am, (% WR:My + (1 - <) wr)
(3.59)

19
Model-adaptive SWME R. Verbiest

2 2
to zero. The generalized Roe linearizations at the remaining interfaces are simply given by

inserted in the fluctuations Tia (8.32) and with the last Mp — My entries of Dyes set

09 j;

1
Ag (wi, wii) + (wind — wi) = | Am, (Piin(s; wr, wiy1)) = (s; wr, wiy1)ds, (3.60)
0

fl,
O®
Ao (wy, Wri) * (Wr41 — W;) = / Amp (Piin(s: Wp, Wr41)) Hen (S5 Wes Wr4a)ds, (3.61)
0 F

for b= dy wns ple 1 ond ee By wns Ng Le

By numerically solving the integrals in (3.57) and (3.58) with a separate quadrature
rule and then adding the numerical approximations, the quadrature points are distributed
independently aE _ two segments ®jow(s;-) and Pnign(s,-). The parameter so can then

be removed from (3 and by transforming the integration interval from [0, so] and
[so, 1], respantively, a the interval [0,1], such that the value of sp does not influence the
PVM and does not need to be specified.

Proposition 3.1 (CIF coupling applied to conservative system). Consider the canonical
domain decomposition example illustrated in F igure [7] Consider the conservative system
of moment equations and a corresponding finite volume scheme of the type
with a numerical fluz function that is well defined between two cells modeled by a
SWME model of the same order. The CIF boundary interface coupling method can be
written in the form for the system of equations for the first Mr +2 variables
by only modifying the flux Prah

iS

Proof. Writing (3.48) for the cells bordering on the interface at «z41/2 for the first Mp +2
variables, we obtain

wit! = wn — x (FR Fr), (3.62)
2
At ~

wR My, WReMy Aa (Fr2 Fr,s). (3.63)

Note that we are only modifying the flux Pe 1 across the interface at +4 and that Pra

+9
and Fh 4 are given by the standard numerical flux (3.49). The discrete time superscripts
2
are removed again in the following. Analogously to i notation introduced in Section B-T]
the flux fiz,(wr) of the system of order Mr is decomposed as

; ( )) fim, (wr) € RM**?, fiuy:m,(wr) © RM®-Me, (3.64)
Mr:Mp\WR

To compute the generalized Roe linearization (3.55) for the conservative system (3.46), we

have to evaluate fiz,(-) in ®pw(0; Wz, wR) and ®,y(1; wz, wR). Since

Dyw(0;Hr, wr) =(wr,9)", — ®pw(1; Wz, wr) = wr, (3.65)
we obtain
fu, (wr)

F(®pw(0; Wi, WR)) = ( es

fMy:Mp (Wz)

) f(®pw(1; Gr, wr)) = fry(wr). (3.66)

20
Model-adaptive SWME R. Verbiest

The generalized Roe linearization at the boundary interface can then be computed as

fi, (wr) )

, (3.67)
fy:Mp (Wz)

Agi, wr): (wr - G1) = Fty(wr) — (

with corresponding numerical viscosity matrix P(A@(Wz,wrR)). The generalized Roe

linearization (3.67) is only used in the fluctuation Dr, ié€ R“k+?, which is defined

2
by inserting the generalized Roe linearization (3.67) in the general formula (3.32). The

fluctuation Died € R™-+? is computed using the standard generalized Roe linearization
By

Ao (ir, wr): (wr —- zr) = fia, (wr) — Fr, wr) (3.68)

in the fluctuation
~ ly ,~ ~ ~ ~
Aj (Wr, wr) = 5 (Ao(iiz, we) - (wr — Wz) — Qa(wz, wR): (wR - wy), (3.69)

with numerical viscosity matrix Qo(@., wr) = P(Ae(wp, wpR)). Note that the generalized
Roe linearization is the same in the fluctuations D>, , and Dt € R“:+? (the first

L+3 L+3,:Mz

Mr, +2 entries of Dra ). It follows that the scheme can be written in conservative form

2
(3.48) for the first My +2 variables, with boundary interface flux function

pn lye n rs n —n nm
Fry aay = 5 (fin wh) + Fan, (wh) — P(Ao Wt, wp))) (3.70

for the first My; + 2 variables.

Remark 3.8. From the above arguments, it follows that if the padded moments of the
padded vector wz are given by (3-50), then reduces to conservative form (3.48) for
the conservative system regardless of the path ®(s; Wz, wr).

The difference between the PBC coupling discussed in Section and the CIF
coupling introduced in this section is that in the PBC coupling the evolution of the padded
values is computed with the PVM equations, while in the CIF coupling the padded values
are identically zero and can be effectively removed from the equations.

4 Numerical simulations

In this section, the two spatial coupling methods PBC (8.41)-(3.43) and CIF (3.59)

proposed in Section are numerically tested, using the domain decomposition criteria
proposed in Section |3.1} As test case, we will consider the collision of a dam break wave
with a smooth wave, see Figure [4] for the initial water height. This is a combination of
commonly considered test cases for the SWME, see for example [17] [20]. At the dam break
wave and the smooth wave, we expect the domain decomposition to indicate the need for
a higher-order SWME model, while in the regions away from the dam break wave and the
smooth wave, we expect the domain decomposition criteria to indicate that a lower-order
SWME model can be used. We further expect that the eventual collision of the dam break
wave and the smooth wave increases the flow complexity and thus requires time adaptivity,
such that a higher-order SWME model is needed for accurate simulations. The accuracy
and runtime of the two spatial coupling methods are compared with the accuracy and
the runtime of an accurate but slow higher-order SWME model and a fast but inaccurate
lower-order SWME model, as well as with a reference solution.

21
Model-adaptive SWME R. Verbiest

Notation. In the remainder of this paper, we will denote the adaptive model with PBC
coupling by the abbreviation A-SWME-PBC and the adaptive model with CIF coupling
by the abbreviation A-SWME-CIF.

4.1 Numerical evaluation of domain decomposition criteria

The model-coarsening criteria and the model-refinement criteria need to
be evaluated on the grid in each cell C;, i = 1,...,Nz, for each time step. This is
computationally cheap compared to the full finite volume update [3.29)- (3.30). For a
practical implementation, only an increase or a decrease in order of one is applied. This
corresponds to My = M; +1 and M, = Mj, for some M; € N, in the notation introduced
in Section [3-1] The efficient implementation of a more general decrease or increase in order
is left to future work.

For the numerical evaluation of the model-coarsening criteria in a cell C; that is
currently modeled by the SWMEy;,+1, assume that the numerical solution w/ has been
obtained up to discrete time tp, and that the current time step tn > tn41 aims at computing
the numerical solution wrt at discrete time tn41. The residual R:yz;(tn,2:) (8.13) is
numerically approximated using the last column of the fluctuation Ad(w™4, w!'), denoted
by Ag: p41 (Wi4,w?), and the last column of the fluctuation Az(w}, w?,,), denoted by

Ag uy,41(w}, wi.,), computed in the previous time step, divided by the grid size Ax:

_ AB agi (Wea wh) + As wai (UP, wid)
) = (4.1)

Rim (tn

Note that Ras,:1,+1(tn, vi) (3.14) describes the time evolution of the highest-order variable
haw,+1); at time t,. Instead of approximating the spatial fluctuations and the source
erm in (3.14), we will approximate the time evolution directly by approximating the
ime derivative of the highest-order variable (hayy,+1)i at time ty using a finite difference
approximation:

(hea)? — (hon, 41))
At

Note that special care needs to be taken when computing and to treat missing
values as a result of the time- or spatially-adaptive subdomains. The approximations
) are then inserted in the model-coarsening criteria (8-15). For the numerical
evaluation of the model-refinement criteria (3.19) in a cell C; that is currently modeled by
he SWMEvw,, the model-refinement wai ety are approximated on the grid:

Roy:M,+1(tn, Gi) © (4.2)

Sipe)

| >Kg, |Ah?| > ka, |A(hum)?| > &a, |A(har)?| > &a,--- | A(ham,)?| > Ka,
(4.3)

with wr = ((w?)”, 0)", and where the partial derivatives in have been re-

placed by central difference approximations denoted by Ah?, A(hum); and A(ha;)?,

j = 1,...,Mj;. The specific values for the tolerances were chosen based on heuristic

esting and are summarized in Table [I]

= 0.25 | Kg = 0.5 || Ka = 0.2

€w = 0.001 |] eR.,,, = 0.005

ER Mj:M;+1

Table 1: Chosen tolerances in and for the adaptive simulation.

22
Model-adaptive SWME R. Verbiest

The extension to higher-order methods (in time and space) requires an adaptation of
the error estimation for the spatial terms as well as for the time integration over the time
step. This is left for future work.

The algorithm for the adaptive simulation is summarized in Algorithm [EJ] First, the
order in each cell is initialized and set to a maximum order Mmaz. For the simulation
results shown in this section, the maximum order was chosen to be Mma, = 5. At each
discrete time ¢,, and in each grid cell C;, the transport and friction updates are computed
according to equations and (3-30), respectively. Then, the model-refinement criteria
(4.3) are evaluated to identify subdomains in which the order of the SWME model should
be increased. Then, in cells that have not been identified for model-refinement, the model-
coarsening criteria are numerically evaluated to identify subdomains in which the
order of the SWME model can be reduced.

Algorithm 4.1 Algorithm for the model-adaptive simulation of SWME
Require: Maz > 0
for i+ 1 to N, do
M{i] — Mmaz > Initialize cell-wise orders
tO
while t < teng do
for i+ 1 to N, do
Compute time step size At
Solve transport step (3.29) with time step At
Solve friction step (3.30) with time step At
if is satisfied and M[i] < Mma then
Mii] — M[iJ+1
is numerically satisfied and M[i] > 0 then > Using

else if (
Mii] + Mii] -—1
tet+At

4.2 Setup and reference solution

The setup of the test case is displayed in Table[2| The initial height h(0, 2) is a combination
of a dam and a smooth wave, see Figure[4| The initial velocity u(0,2,¢) is linear in the
vertical variable and does not vary in the horizontal variable. The time step size At” at
each time step n is computed by the CFL-condition, based on the system matrix of the
highest order that was observed in the spatial cells, and was taken to be constant in all
grid cells.

Reference solutions are obtained using the software framework employed in [20] to solve
the reference system ( . The reference simulations have been obtained using a grid
with a spatial resolution of Av,e¢ = 0.02 in x—direction and Aer = 0.005 in ¢—direction,
with a CFL number of 0.5. We refer to [20] for details.

4.3. Numerical results

In this subsection, the results of the numerical simulation of a dam-break wave colliding
with a smooth wave for three friction cases are shown. For each friction case, four models
are simulated: (1) The lower-order model (either the SWME; or the SWMEz, depending

23
Model-adaptive SWME R. Verbiest

Friction parameters (v, A) € {(0.1, 0.1), (1, 0.1), (0.1, 1)}

Spatial domain x € {[—20, 20]

Spatial resolution Az = 0.004

End time tena 5

Initial condition a 4, xe-T
MOM=) oy ete” p> —7

Um(0, 2) = 0.05

ay, = —0.01

a=0, i>l

Initial velocity profile u(0,2,¢) = 0.04 + 0.02¢
CFL number 0.5

Table 2: Numerical setup for collision of a dam break wave with a smooth wave.

42

3.8

3.6

34

3.2

28

Figure 4: Initial height profile of the test case displayed in Table [2|

on the friction case); (2) the SWMEs model, further referred to as the higher-order model;
(3) the A-SSWME-PBC; (4) the A-SSWME-CIF. The friction parameters A (slip length) and
y (kinematic viscosity) play an important role in the shape of the vertical velocity, because
their magnitudes are closely related to the magnitude of the source terms that drive the
vertical variability in the velocity profile. We therefore expect to see qualitative differences
in the performances of the adaptive schemes for the different friction cases defined in
Table} The accuracy and the runtime of the four models will be compared, as well as the
domain decompositions using the two adaptive schemes. The higher-order SWME; showed
sufficient convergence towards the reference solution, such that the reference solution is
not shown in the plots and only used to compute relative model errors.

Friction case 1: \ = 1 and vy = 0.1. In this friction case, the slip length \ is large
compared to the viscosity v. The large slip indicates that the velocity profile is not relaxing
toward zero so quickly at the bottom, whereas the small viscosity is unlikely to result in

24
Model-adaptive SWME

R. Verbiest

a strongly variable vertical velocity profile because of little internal friction. The adaptive
models resulted in a minimum order M = 1, so the SWME; model was chosen as the

lower-order model for fair comparison. The results a

4
38

3.6

34

32
= 1
——h (reference)

Adaptive order: PBC.
+ _ Adaptive order: CIF o

3

28
20-15 = -10 5 0 5 10 15 20

x

(a) Water height h alongside adaptive orders of
PBC and CIF in full domain

03

0.25

02

0.15

0.4

0.05

—— SWME,
—-—- SWME,

0.05 ||- — A-SWME-PBC
ssn A-SWME-CIF

0

“0.4
-20 15-10 5 0 5 10 15 20

x

(c) Mean velocity um in full domain

time t = 5 are shown in Figure [5]

3.9

38

37

3.6

35 Lf

34

3.3

3.2

3.4

——SWME,
— SWME,

A-SWME-PBC.
eligi A-SWME-CIF

-0.07

-0.08

-0.09

“0.4

3 2 a 0 1 2 3
x

(b) Water height h in subdomain

——SWME,
ae SWME,

- - A-SWME-PBC
oss ASSWME-CIF

2000-15 10 5 0 5 10 15 20

x

(d) First moment ai in full domain

Figure 5: Collision of a dam break wave with a smooth wave with friction parameters A = 1
and v = 0.1 (friction case 1) at time tend = 5. (a): Solid blue line is the simulated water height
from the reference solution. The red crosses and the blue plus signs are the orders in each cell
using the PBC coupling and the CIF coupling, respectively. (b)-(d): The lower-order model is the
SWME;, (solid red line). The higher-order model is the SWME; model (blue dash-dotted line).
The A-SWME-PBC (black dashed line) and the A-SWME-CIF (green dotted line) yield similar
results, close to the higher-order model, for the height h, mean velocity u,, and first moment aj.

The dam break wave and the smooth wave have collided and the result of the collision is
located approximately in the subdomain [—3, 3]. The PBC coupling and the CIF coupling
yield different domain decompositions, with the PBC coupling generally yielding higher
order than the CIF coupling in regions where the two coupling methods result in a different
order, see Figure al This is observed in the subdomain [4,13], for example. The reason
for this is that in the PBC coupling, the cells are grouped into groups of four and given the
same order, which is the highest order appearing in the four cells. Moreover, the padded
moment in the padded buffer cell in the PBC coupling are in general not equal to zero,
such that the first condition in is not automatically satisfied, contrary to in the CIF
coupling. This is also observed for the other friction cases presented in this section. The

differences in both the height h (Figure 5b)

25

and the mean velocity um (Figure 5c) between
Model-adaptive SWME R. Verbiest

he higher-order model and the lower-order model are small. This can be explained by the
fact that the slip length is large compared to the small viscosity, such that there is little
friction with the bottom and little internal friction that creates a complex vertical velocity
profile. The A-SWME-PBC and A-SWME-CIF yield similar results for the height h and
he average velocity Um that are close to the higher-order model, especially compared to
he lower-order model. This is also observed for the first moment a1, (Figure[5d), for which
he difference between the higher-order model and the lower-order model is considerable.

However, for the first moment a1, there is a small region, approximately the interval [6, 7|
in which the PBC coupling yields a different numerical solution than the CIF coupling,
with the former being closer to the higher-order model. This is a result of the different
domain decompositions of the two coupling methods in this interval, see Figure al

Note that the A-SWME-PBC and the A-SSWME-CIF deviate from the higher-order
SWME:; for the first moment a, at the boundaries, see Figured] Instead, the A-SWME-
PBC and the A-SWME-CIF are close to the lower-order SWME). The same behavior is
observed for the following friction cases. Since there are no gradients at the boundaries,
the model error at the boundaries can be reduced by reducing the tolerance value €y and
increasing the tolerance value xg in Table

Friction case 2: } = 0.1 and y=0.1. In this friction case, the slip length A is smaller
compared to the previous friction case, so that there is more friction with the bottom,
which creates a more complex vertical velocity profile. The viscosity v is small such that
there is little internal friction. The adaptive models resulted in a minimum order M = 1,
so the SWME; was chosen as lower-order model for fair comparison. The results at time
t = 5 are shown in Figure [6] The water height in the full domain at the end time teng = 5
together with the adaptive orders using the PBC coupling (red crosses) and the CIF

coupling (blue plus signs) is shown in Figure [6a]

The dam break wave and the smooth wave collided similarly as in the previous friction
case. Compared to the previous friction case in which the slip length was larger than the
viscosity, the differences in both the height h (Figure|6b) and the mean velocity um (Figure
between the higher-order model and the lower-order model are considerably larger. The
reason for this is that there is more bottom friction, causing higher-order vertical velocity
profile deviations. The A-SWME-PBC and A-SWME-CIF yield nearly identical results
for the height h and the average velocity u,, that are close to the higher-order model,
especially compared to the lower-order model. This is also observed for the first moment

a, (Figures [édh.

Friction case 3: \ = 0.1 and vy = 1.0. In the third friction case, the viscosity v is
larger compared to the previous friction cases, so that there is more internal friction that
can result in a more complex velocity profile. The slip length \ is small, so that there
is considerable friction with the bottom, as in the previous friction case. The adaptive
models resulted in a minimum order M = 2, so the SWMEz was chosen as the lower-order
model for fair comparison. The results at time t = 5 are shown in Figure [7] The water
height in the full domain at the end time teng = 5 together with the adaptive orders using
the PBC coupling (red crosses) and the CIF coupling (blue plus signs) is shown in Figure

The dam break wave and the smooth wave collided similarly as in the previous friction
cases. The differences in both the height h (Figure [7b) and the mean velocity u,, (Figure
between the higher-order model and the lower-order model are considerable. The

26
Model-adaptive SWME

R. Verbiest

4

3.8

3.6

3.4

32

——h (reference)
~ Adaptive order: PBC
+ Adaptive order: CIF a

3

28
20-15 = -10 5 0 5 10 15 20
x

(a) Water height h alongside adaptive orders in
full domain
0.3

neenernanneny
0.25
0.2
0.15
= 0.1
3
0.05 L_.
o||——- Swe,
--—- SWME,
0.057 | — A-SWME-PBC
sos A-SWME-CIF
0.1
-20 15, -10 5 0 5 10 15 20

x

(c) Mean velocity uw, in full domain

Figure 6: Collision of a dam break wave with a smooth wave with friction parameters \ = 0.

and v = 0.1 (friction case 2) at time tena =

from the reference solution. The red crosses and the blue plus signs are the orders in each cel.

using the PBC coupling and the CIF coup
the SWME,; (solid red line). The higher-ord

39
—SWME
38 :
— SWME,
37 — — A-SWME-PBC
ssh HON es A-SWME-CIF

35

34

33

3.2

0.05

-0.1

-0.15

—SWME,
—— SWME,

= — A-SWME-PBC
wees A-SWME-CIF

-0.2

-0.25
“2000-15 10 5 0 5 10 15 20
x

(d) First moment a, in full domain

5. (a): Solid blue line is the simulated water heigh

ing, respectively. (b)-(d): The lower-order model is
er model is the SWMEs (blue dash-dotted line). The

A-SWME-PBC (black dashed line) and the A-SSWME-CIF (green dotted line) yield similar results,

close to the higher-order model, for the heig

reason for this is that there is large bo
higher-order vertical velocity profile dev:

ht h, mean velocity u,,, and first moment ay.

om friction and large internal friction, causing

iations. The A-SWME-PBC and A-SWME-CIF

yield similar results for the height h and the average velocity uw, that are close to the

higher-order model, especially comparec

for the first moment a1 (Figure[7d), apar

which the PBC coupling yields results that are closer to the higher-order model, comparec
to the CIF coupling. This is a result of the different domain decompositions obtained by

the PBC coupling and the CIF coupling

A-SWME-CIF yield nearly identical results for the second moment a2 (Figure [7e), apart
from in a small region around « = 15, in which the PBC coupling yields results that are
closer to the higher-order model, compared to the CIF coupling. Again, this is a result of
the different domain decompositions obtained by the PBC coupling and the CIF coupling.

In all three test cases, the adaptive models A-SSWME-PBC and A-SWME-CIF yielc

to the lower-order model. This is also observec
rom in the approximate subdomain [—10, —6], in

see Figure [fa] Finally, the A-SWME-PBC anc

similar and accurate results, compared to the higher-order SWME;. This indicates that

27
Model-adaptive SWME R. Verbiest

37
4 5 ——SWME,
38 ---- SWME,
a 4 = -— A-SWME-PBC
8 -SWME-CIF
36 i
me 34
= 3
3.4 fe} St
2 33
3.2
4 32
——h (reference)
A Adaptive order: PBC. 34
Adaptive order: CIF a
28 3
-20 “15 10 5 0 5 10 15 20
m 3 2 1 0 1 2 3
(a) Water height h alongside adaptive orders in x
full domain (b) Water height h in subdomain
0.2 0
-0.02 %
0.15
0.04
01
-0.06
e #
= 0.05
-0.08
i
of |——_- SWE, " i —SWNE,
---- SWME, \ ---- SWME,
0.05 | |- — A-SWME-PBC 0.12 NN ~~ ASWME-PBC
sos A-SWME-CIF soe A-SWME-CIF
-20 15, -10 5 0 5 10 15 20 -20 “15 “10 5 0 5 10 15 20
x x
(c) Mean velocity uw, in full domain (d) First moment a, in full domain
0.01
0
-0.01
-0.02
0.03
& 0.04
-0.05
-0.06 | —— SWME,,
0.07} |=--= SWME,,
0a ||" ~ A-SWME-PBC
«+ A-SWME-CIF
-0.09
-20 “15 -10 5 oO 5 10 15 20
x
(e) Second moment az in full domain
Figure 7: Collision of a dam break wave with a smooth wave with friction parameters A = 1

and v = 1.0 (friction case 3) at time tena = 5. (a): Solid blue line is the simulated water height
from the reference solution. The red crosses and the blue plus signs are the orders in each cell
using the PBC coupling and the CIF coupling, respectively. (b)-(e): The lower-order model is
the SWMEz (solid red line). The higher-order model is the SWMEs (blue dash-dotted line). The
A-SWME-PBC (black dashed line) and the A-SSWME-CIF (green dotted line) yield similar results,
close to the higher-order model, for the height h, mean velocity u,,, first moment a, and second
moment Q2.

the A-SWME-PBC and the A-SSWME-CIF correctly capture the regions that require a

28
Model-adaptive SWME R. Verbiest

Friction Lower-order Higher-order Adaptive Adaptive
yD SWME)/SWME»2 SWMEs, A-SWME-PBC | A-SWME-CIF
A=1.0,v=0.1 0.26 1.00 0.37 0.38
A=0.1,4¥=0.1 0.28 1.00 0.41 0.41
A=0.1,v=1.0 0.38 1.00 0.38 0.42
Table 3: Relative simulation time comparison of the lower-order SWME, (for A = 1.0,v = 0.1
and A = 0.1,v = 0.1) or SWMEz (for A = 0.1,v = 1.0), the higher-order SWME;, A-SWME-PBC

and the A-SSWME-CIF for the test case described in Table [| relative to the simulation time of the
higher-order SWMEs.

1igher order.

4.3.1 Runtime and error comparison

The model-adaptive simulation of the SWME aims at obtaining a computational speedup
while achieving a certain accuracy. Therefore, the simulation times and the error norms
with respect to a reference solution are compared here for the test case described in Table

Runtime comparison. The relative runtime of the simulations run with the different
models is shown in Table3| For each friction case, there is a significant decrease in runtime
of up to 60 percent using the ACSSWME-PBC or A-SWME-CIF compared to the higher-
order model SWMEs, with the A-SSWME-PBC having a slightly smaller runtime than the
A-SWME-CIF. This speedup already includes the evaluation of the domain decomposition
criteria, which therefore yield only small overhead.

Error norm comparison. The error norms of the numerical solution with respect to
the reference solution are shown in Table [4] for the different friction cases. The reference
solution and the moment models were simulated on increasingly fine spatial and temporal
grids until they had sufficiently converged.

For the friction case \ = 1 and v = 0.1, it is observed in Figure [5] that the lower-order
SWME model is already accurate for the height h and the mean velocity um, explaining
why the error norms for the different models are of the same order in this friction case. The
adaptive models A-SSWME-PBC and A-SWME-CIF result in smaller error norms than the
aigher-order SWMEs, which is likely a result of the numerical error that is of the same
order as the model error for the height h and the mean velocity um in this friction case.
This is also observed for the other friction cases in Table] For the first-order moment a,
he error norms of the A-SSWME-PBC and A-SWME-CIF are approximately one order
of magnitude larger than the error norm of the higher-order SWME model, whereas the
error norm of the lower-order SWME model is approximately two orders of magnitude
arger than the error norm of the higher-order SWME model.

For the friction case X = v = 0.1, the error norms of the A-SWME-PBC and A-
SWME-CIF are approximately one order of magnitude smaller than the error norm of the
ower-order SWME model for all the variables.

Finally, for the friction case \ = 0.1 and v = 1.0, the error norms of the A-SSWME-PBC
and A-SWME-CIF are of the same order as the higher-order SWME model and between

29
Model-adaptive SWME

R. Verbiest

3 and 8 times smaller than the error norms of the lower-order SWME model for all the

variables.

Friction Var Lower-order Higher-order Adaptive Adaptive
A, * | SWME 1/SWME2 SWME; A-SWME-PBC | A-SWME-CIF

h 3.6e—3 3.4e—3 6e—3 6e—3

A= 1.0
v=0.1 | Um 3.4e—2 3.le—2 Ae—2 Ae—2
ay 3.le—1 5.le—3 4.6e—2 4.fe—2
h 1.3e—2 3.le-3 9e—3 9e—3

A=1.0
v=10| um 1.6e—1 3.le—2 2.4e—2 2.4e—2
ay 8.2e—-1 8.0e—3 -le-1 -le-1
h 3.3e—3 1.7e—3 -le-—3 -le-—3
N=0.1 | Um 5.4e—2 2.9e—2 .8e—2 .8e—2
v=10 [ay 6.6e—2 9.0e—3 8.0e—3 Ae—2
ag 8.9e—2 3.0e—2 2.0e—2 2.9e—2

Table 4: Error n

A-SWME-PBC and

orm comparison of the lower-order SWME}, the higher-order SWMEs, the
A-SWME-CIF for the three test cases described in Table [|

The runtime and error comparison shows the decrease in runtime of the A-SSWME-PBC
and the A-SSWME-CIF compared to the higher-order SWME model while simultaneously
keeping the accuracy close. Furthermore, the A-SWME-PBC and the A-SSWME-CIF yield
similar domain decompositions, similar results and similar runtimes.

5 Conclusion

In this paper, we proposed a space- and time-mode

-adaptive procedure for the simulation

of a free surface flow modeled by the hierarchical SWME. The adaptive procedure consists
of a domain decomposition and a spatial coupling method. The domain decomposition

is based on a decomposition of the SWME model

hat exploits the hierarchical structure

of the SWME, resulting in a set of error estimators and a set of domain decomposition

criteria. This effectively decomposes the
a SWME model of a suitable order. Next, the subdomains are coupled at
interfaces using a spatial coupling met

domain into a set of subdomains each modeled by

heir boundary

10d. We proposed two different spatial coupling

methods: (1) The PBC coupling uses a padded buffer cell with padded values that are

dynamically updated; (2) The CIF cou

pling sets

he padded values to zero, resulting in

a coupling method that can be written in conservative form by only modifying the fluxes

at the boundary interfaces. Time adapt

ivity is included by decomposing the domain and

accordingly applying the spatial coupling formulas in every time step. We performed a

numerical simulation of a dam break co

liding with a smooth wave. The adaptive models

with PBC coupling and with CIF coupling showed accurate results and significant speedups

of up to 60 percent compared to a higher-order model.

Ongoing work focuses on the application of the model-adaptive simulation procedure to

30
Model-adaptive SWME R. Verbiest

two-dimensional flow and different hierarchical moment models. A suggestion for future
work is the combination of the model-adaptive simulation procedure with data-driven
methods for the estimation of the model error.

6 CRediT authorship contribution statement

R. Verbiest: Conceptualization, Methodology, Software, Formal Analysis, Investigation,
Data Curation, Writing - Original Draft, Writing - Review & Editing, Visualization. J.
Koellermeier: Conceptualization, Methodology, Writing - Review & Editing, Supervi-
sion, Funding acquisition.

7 Acknowledgments
This work is part of the project HiWAVE with file number VI.Vidi.233.066 of the ENW
Vidi research programme, funded by the Dutch Research Council (NWO).

A Analytical formulas for 6Ayy,,1,(@m,) and 6Sy,,My (ty)

Let M,, My € N be the orders of two SWME models, with My, < My. The appendix
uses the notation introduced in Recall the definition of the system matrix of the
SWMEm,;:

AMy (my) = OF sal) ~ Quy (ary) € RMF (Mn F2) (A.1)
wWMy
where F(idagy) € R™+? is the conservative flux and where Qa (‘8an,) € Ri Met?) (Mtr+2)
contains the non-conservative flux terms. The quantity JAny, my, (Wm,) € R(Mi+2)x (Mi +2)
defined by Equation is split into a part corresponding to the conservative terms and
a part corresponding to the non-conservative terms:

_ O6F v4.0 (Ooty)

JAN, May) = — 6Q M,Mu (On). (A.2)

OWM,
Here, the conservative part oF Mi. My (My) € IR™L+2 is defined as
sa - z A M,+2 é
OF My, .My (my) = Fim, (@my) — Fi, (.m,) € RMT, (A.3)

where the first Mr +2 entries of F My (Wan) € RM#*? are defined by F M,(Omy) € RM+,
and the non-conservative part OQ, My (my) € ROW%+2)*(ML42) is defined as

6QM My (My) = Q:My My, Omy) — Quy, (im,) € RYE) O42), (A.4)

where Q.i,,:m,(Wmy) € ROM+2)*(“L+2) are the first Mr +2 rows and the first My +2
columns of the matrix Qi, (Wm,)-

31
Model-adaptive SWME R. Verbiest

OF omy OMy) & IR(ML+2)x(Mi42) jg

Conservative part. First, the Jacobian matrix oax
L

calculated. Writing
OF \1,,My (My) = (5Fo,6F1,.-.,5F 41), (A.5)

the vector OF ur, My(W14,) can be constructed explicitly by computing the entries 5F;,
j =0,1,...,Mt+1, which can be computed by subtracting the conservative flux terms
appearing in the mass balance equation (2.8), the momentum balance equation and
the moment equations for a; (2.10), er My, of the SWMEj,, from the respective

conservative flux terms in the first My, + 2 equations of the SWMEyy,,. We obtain

ihe a?
6Fy = 6F, =h _—
0=9, LB > WaT’
i=M,+1
(A.6)
My, My Mu
j=l k=My41 jk=My41
The partial derivatives of OF) and 6Fj41, i= 1,..., Mi, with respect to h, hum and ham,
m=1,...,Mz, can then be easily computed using (A6). We obtain
My 2 se
OOF; ; OOF OOF
Oh == 3 wat O(hi To ath és (A7)
i=Mp4+1 2+1 ( Wm) ( Om)m=1,...,Mz,
and
M, M M
OO Fi41 x 4 s OOF 41
a, = -2) > Aijrajar — > AijrajQp, Aim) ='0,
j=l k=M,41 jk=My +1
uM (A.8)
06 Fiat 4 OK
es) Ame——:
O(hOm)m=1,....Mi ay im" Ok +1
The Jacobian matrix OOF ahs (Fn) is thus given by
‘My,
0 0 O =: 0
a 0 OO =: 0
O5F nt, Mia (tn) = bi 0 cu tte C1iM, ; (A.9)
OW My
bm, O CM -** CMM,

32
Model-adaptive SWME R. Verbiest

where we defined

ie a?
a=-— a A.10
i=My41
M, My Mu
bj = 25° > Ajjrajarn — > Aijrajor, (A.11)
j=l k=M,41 j.k=My4+1
My
Of,
ey=2 So Aina ey: (A.12)
k=M,4+1

pata eis part. The mass balance equation (2.8) and the momentum balance
equation do not contain non-conservative terms. The non- Seas in 19 ae in the
moment Shion for a; (2.10) is given by the term denoted by Qj+1 in . We write

6Q un,.My (t6ij,), Which is defined via 6Qmn, My(OMy) = 9QM.,.Mu joe UM:

6Q My, My (WMy) = (0,0,5Qo,--.,5Qar 41)". (A.13)

Subtracting the non-conservative flux terms Qj41, i = 1,..., ML, appearing in the mo-
ment equations for a; (2-10), i=1,..., Mz, of the SWMEy, from the respective non-
conservative flux terms in the first My, + 2 equations of the SWMEy,,, the entries 6Q;+1
can be written explicitly for i=1,...,Mz:

ML My Ma M, My
6Qit1 = — > BijxOx (ha; )on— > > BijrOx (ha; )on— > BijrOx (hag ar.
j=l k=My41 j=Mit1k=1 j,k=My4+1
(A.14)
Using (A.14), the matrix 6Qag, 4 (@,) can be constructed. We obtain
0 0 0 tee 0
0 0 0 tee 0
M M
6QM..Mu (Wy) = 0 - eM 41 Biuror + — eM 41 Bi muk&r
00 -a1 Banakoe oo — ely 1 Beak
(A.15)

The matrix Aj, (@yy,) is computed by inserting (A.9) and (A.15) into (A.1).
Similarly, the quantity 55, My,.My (my) defined by (3.7) can be calculated analytically.

The vector 69 ‘My,,My (my) is written as
65M, My (OM) = (0,65S0,-..,5Sn0,)7 € RME*?. (A.16)
19

Using the general SWME equations ) and subtracting the source term of the
SWME,y,, from the first My + 2 entries of the SWMEyy,,, we obtain

Mu My

»
dS) ay, 68: =—(2+1)5 > (14 fas)as, i=1,..., Mz. (4.17)

J=Mi+1 J=Mi+1

Vv

650 = — 7

33
Model-adaptive SWME R. Verbiest

Inserting (A.17) in (A.16]
(A.9), (A.15) and (

) yields Sig, 144, (W uy). It is readily observed from expressions
7) that for vanishing moments ay,41 =... = @My = 0, both

Amy (Guy) and 6Syy, .1ty(W,) vanish.

References

1

or

I. Abdelmalik and E. van Brummelen. Error estimation and adaptive moment
hierarchies for goal-oriented approximations of the Boltzmann equation. Computer
Methods in Applied Mechanics and Engineering, 325:219-239, 2017.

Ml. Bader, C. Bock, J. Schwaiger, and C. Vigh. Dynamically Adaptive Simulations
with Minimal Memory Requirement—Solving the Shallow Water Equations Using
Sierpinski Curves. SIAM Journal on Scientific Computing, 32(1):212-228, 2010.

Ml. Bauerle, A. J. Christlieb, M. Ding, and J. Huang. On the rotational invariance and
hyperbolicity of shallow water moment equations in two dimensions. SIAM Journal
on Mathematical Analysis, 57(1):1039-1085, 2025.

M. J. Berger and J. Oliger. Adaptive mesh refinement for hyperbolic partial
differential equations. Journal of Computational Physics, 53(3):484-512, 1984.

A. Canestrelli, A. Siviglia, M. Dumbser, and E. Toro. Well-balanced high-order
centred schemes for non-conservative hyperbolic systems. applications to shallow
water equations with fixed and mobile bed. Advances in Water Resources, 32:834-844,

06 2009. [T3} [Tq]

M. J. Castro Diaz and E. Ferndndez-Nieto. A Class of Computationally Fast First
Order Finite Volume Solvers: PVM Methods. SIAM Journal on Scientific Computing,
34(4):A2173-A2196, 2012.

R. Donat, M. C. Marti, A. Martinez-Gavara, and P. Mulet. Well-Balanced Adaptive
Mesh Refinement for shallow water flows. Journal of Computational Physics, 257:937
953, 2014.

Y. Fan and J. Koellermeier. Accelerating the Convergence of the Moment Method
for the Boltzmann Equation Using Filters. Journal of Scientific Computing, 84(1):1,
2020. [7]

T. Fondelli, A. Andreini, and B. Facchini. Numerical Simulation of Dam-Break
Problem Using an Adaptive Meshing Approach. 70th Conference of the Italian
Thermal Machines Engineering Association, ATI2015, 82:309-315, 2015.

P. Garcia-Navarro, J. Murillo, J. Ferndndez-Pato, I. Echeverribar, and M. Morales-
Hernandez. The shallow water equations and their application to realistic cases.
Environmental Fluid Mechanics, 19(5):1235-1252, 2019.

J. Garres-Diaz, M. J. Diaz Castro, J. Koellermeier, and T. Morales de Luna.
Shallow water moment models for bedload transport problems. Communications
in Computational Physics, 30(3):903-941, 2021.

34
Model-adaptive SWME R. Verbiest

fo>)

a

ie.)

o

20

21

22

23

24

Q. Huang, J. Koellermeier, and W.-A. Yong. Equilibrium stability analysis of
hyperbolic shallow water moment equations. Mathematical Methods in the Applied
Sciences, 45(10):6459-6480, 2022.

I. Kissami, M. Seaid, and B. Fayssal. Numerical assessment of criteria for mesh
adaptation in the finite volume solution of shallow water equations. Advances in
Applied Mathematics and Mechanics, 12(2):503-526, 2020.

J. Koellermeier. Error estimators for adaptive simulation of rarefied gases using
hyperbolic moment models. AIP conference proceedings, 2132(1):120004, 2019.

J. Koellermeier, P. Krah, and J. Kusch. Macro-micro decomposition for consistent and
conservative model order reduction of hyperbolic shallow water moment equations:
a study using POD-Galerkin and dynamical low-rank approximation. Advances in
Computational Mathematics, 50(4):76, 2024.

J. Koellermeier and E. Pimentel-Garcia. Steady states and well-balanced schemes
for shallow water moment equations with topography. Applied Mathematics and
Computation, 427:127-166, 2022.

J. Koellermeier and M. Rominger. Analysis and Numerical Simulation of Hyperbolic
Shallow Water Moment Equations. Communications in Computational Physics,

28(3):1038-1084, 2020.

J. Koellermeier and H. Vandecasteele. Hierarchical micro-macro acceleration for
moment models of kinetic equations. Journal of Computational Physics, 488:112194,
2023. B]

J. Kéllermeier. Derivation and Numerical Solution of Hyperbolic Moment Equations
for Rarefied Gas Flows. PhD thesis, RWTH Aachen University, Aachen, 2017.
Dissertation. Supervisors: Manuel Torrilhon and Ruo Li.

J. Kowalski and M. Torrilhon. Moment Approximations and Model Cascades for
Shallow Flow. Communications in Computational Physics, 25(3):669-702, 2019.

AB ABE AE 2423)

Y. Lakhlifi, $. Daoudi, and F. Boushaba. Dam-Break Computations by a Dynamical
Adaptive Finite Volume Method. Journal of Applied Fluid Mechanics, 11(6):1543
1556, 2018. [2]

D. Liang. Evaluating shallow water assumptions in dam-break flows. Proceedings of
the Institution of Civil Engineers - Water Management, 163(5):227-237, 2010.

F. Mintgen. Coupling of Shallow and Non-Shallow Flow Solvers - An Open Source
Framework. PhD thesis, 2018.

C. Schmeiser and A. Zwirchmayr. Convergence of Moment Methods for Linear Kinetic
Equations. SIAM Journal on Numerical Analysis, 36(1):74-88, 1998.

U. Scholz, J. Kowalski, and M. Torrilhon. Dispersion in Shallow Moment Equations.
Communications on Applied Mathematics and Computation, 2023.

35
Model-adaptive SWME R. Verbiest

28

29

30

I. Steldermann, J. Biinning, E. Pummer, and J. Kowalski. Dimensionally reduced
shallow moment simulations of a pumped-storage plant tunnel system. 2024.

I. Steldermann, M. Torrilhon, and J. Kowalski. Shallow moments to capture vertical
structure in open curved shallow flow. Journal of Computational and Theoretical
Transport, 52(7):475-505, 2023.

I. Toumi. A weak formulation of roe’s approximate riemann solver. Journal of
Computational Physics, 102(2):360-373, 1992.

R. Verbiest and J. Koellermeier. Capturing vertical information in radially
symmetric flow using hyperbolic shallow water moment equations. Communications
in Computational Physics, 37(3):810-848, 2025.

R. Verbiest and J. Koellermeier. Spatially adaptive moment model using padded
buffer cell for linear hierarchical moment equations. 2025. accepted.

36
